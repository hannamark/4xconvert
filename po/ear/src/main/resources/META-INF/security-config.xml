<?xml version='1.0'?>
<!DOCTYPE policy PUBLIC
"-//JBoss//DTD JBOSS Security Config 3.0//EN"
"http://www.jboss.org/j2ee/dtd/security_config.dtd">

<policy>
    <application-policy name="po">
        <authentication>
            <!--
                Notes on the policy here:
                - Designed to work in both dev and production, which is why the first two are optional.
                - Last module only adds roles information from CSM.  Since it won't authenticate anyone
                and it is required, this effectively makes one of the first two required.
                - The Commons*LoginModule use CSM and integrates with the JBoss password stacking
                mechanism.
            -->
            <login-module code="com.fiveamsolutions.nci.commons.authentication.CommonsLDAPLoginModule"
                flag="optional">
                <module-option name="ldapHost">${ldap.host.url}</module-option>
                <module-option name="ldapSearchableBase">${ldap.searchable.base}</module-option>
                <module-option name="ldapUserIdLabel">{ldap.user.id.label}</module-option>
            </login-module>
            <login-module code="com.fiveamsolutions.nci.commons.authentication.CommonsDBLoginModule" flag="optional">
                <module-option name="driver">${jdbc.driverClassName}</module-option>
                <module-option name="url">${jdbc.url}</module-option>
                <module-option name="user">${jdbc.username}</module-option>
                <module-option name="passwd">${jdbc.password}</module-option>
                <module-option name="query">SELECT * FROM csm_user WHERE login_name=? and password=?</module-option>
                <module-option name="encryption-enabled">YES</module-option>
            </login-module>
            <login-module code="org.jboss.security.auth.spi.DatabaseServerLoginModule" flag="required">
                <module-option name="password-stacking">useFirstPass</module-option>
                <module-option name="dsJndiName">java:po-xa-ds</module-option>
                <module-option name="rolesQuery">
                    SELECT cg.group_name, 'Roles' FROM csm_group cg, csm_user_group cug, csm_user cu WHERE cg.group_id =
                    cug.group_id AND cug.user_id = cu.user_id AND cu.login_name = ?
                </module-option>
            </login-module>
        </authentication>
    </application-policy>
    <!-- 
        NOT USED! Why? Because when this was referenced within po-jms-ds.xml using <security-domain-and-application>POJmsXARealm</security-domain-and-application>
        the application just would NOT work (kept getting an authentication error when attempting to create the JMS Session from the Connection. 
        See http://www.jboss.org/community/docs/DOC-9350 
        * May also want to force XA by using XATxCM instead of TxCM
    <application-policy name="POJmsXARealm">
       
       <authentication>
          <login-module code="org.jboss.resource.security.ConfiguredIdentityLoginModule" flag="required">
             <module-option name="principal">guest</module-option>
             <module-option name="userName">guest</module-option>
             <module-option name="password">guest</module-option>
             <module-option name="managedConnectionFactoryName">jboss.jca:service=TxCM,name=POJmsXA</module-option>
          </login-module>
       </authentication>
    </application-policy>    
    -->
</policy>