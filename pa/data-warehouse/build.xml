<project name="data-warehouse" default="populate" basedir="." xmlns:ivy="antlib:org.apache.ivy.ant">
    <property file="${basedir}/build.properties"/>
    <property name="bda-utils" value="${basedir}/../../target/pa/bda-utils" />
    
    <path id="bda-utils.classpath">
        <fileset dir="${bda-utils}">
            <include name="**/*.jar" />
        </fileset>
    </path>
    
    <taskdef resource="net/sf/antcontrib/antlib.xml" classpathref="bda-utils.classpath"/>
    <taskdef classname="org.codehaus.groovy.ant.Groovy" classpathref="bda-utils.classpath" name="groovy"/> 
    
    <target name="init-db" description="Initializes the data warehousing tables">
        <sql driver="${datawarehouse.pa.dest.jdbc.driver}" url="${datawarehouse.pa.dest.jdbc.url}" 
            userid="${datawarehouse.pa.dest.db.username}" password="${datawarehouse.pa.dest.db.password}" expandproperties="true">
            <transaction src="${basedir}/sql/families.sql"/>
            <transaction src="${basedir}/sql/generic_contact.sql"/>
            <transaction src="${basedir}/sql/study.sql"/>
            <transaction src="${basedir}/sql/anatomic_site.sql"/>
            <transaction src="${basedir}/sql/biomarker.sql"/>
            <transaction src="${basedir}/sql/disease.sql"/>
            <transaction src="${basedir}/sql/grant.sql"/>
            <transaction src="${basedir}/sql/indide.sql"/>
            <transaction src="${basedir}/sql/participating-site.sql"/>
            <transaction src="${basedir}/sql/misc.sql"/>
            <classpath>
                <path refid="bda-utils.classpath"/>
            </classpath>
        </sql>
    </target>
    
    <target name="populate" depends="init-db" description="Populates the data warehousing tables using the given database">
        <groovy src="groovy/org_families.groovy"/>
        <groovy src="groovy/generic_contact.groovy"/>
        <groovy src="groovy/study.groovy"/>
        <groovy src="groovy/anatomic_site.groovy"/>
        <groovy src="groovy/biomarker.groovy"/>
        <groovy src="groovy/disease.groovy"/>
        <groovy src="groovy/grants.groovy"/>
        <groovy src="groovy/indide.groovy"/>
        <groovy src="groovy/participating_site.groovy"/>
    </target>
</project>