<?xml version="1.0"?>
<project default="test" name="ctro-selenium2">
	
	<property name="default.target.dir" value="target" />
	<property name="classes.dir" value="${default.target.dir}/classes" />
	<property name="test.classes.dir" value="${default.target.dir}/test-classes" />
	<property name="test.report.dir" value="${default.target.dir}/test-reports" />
	<property name="lib.dir" value="lib" />
	<property name="source.dir" value="src" />
	<property name="test.source.dir" value="test" />
	<property name="test.pattern" value="**/**Test.java" />
	
	<!-- paths used for compilation and run  -->
	<path id="lib.path.id">
		<fileset dir="${lib.dir}" />
	</path>
	<path id="run.path.id">
		<path refid="lib.path.id" />
		<path location="${default.target.dir}" />
	</path>
	
	<!-- Create the classpath from the lib directory -->
	<target name="init" depends="clean">
		<mkdir dir="${classes.dir}" />
		<mkdir dir="${test.classes.dir}" />
		<path id="build.classpath">
			<pathelement path="${test.classes.dir}" />
			<pathelement path="${classes.dir}" />
			<fileset dir="${lib.dir}">
				<include name="**/*.jar" />
			</fileset>
		</path>
	</target>

	<!-- Compiles all the .java files in the test directory -->
	<target name="compile-tests" depends="init" description="compiles all .java files in test directory ">
		<javac destdir="${test.classes.dir}" srcdir="${test.source.dir}" classpathref="lib.path.id" debug="true" />
	</target>

  <target name="test" depends="compile-tests">
	<mkdir dir="${test.report.dir}" />
	<junit dir="${basedir}" printSummary="on" fork="true" haltonfailure="false" >
		<sysproperty key="basedir" value="${basedir}" />
		<formatter type="xml" />
		<classpath>
			<path refid="build.classpath" />
			<pathelement path="${test.classes.dir}" />
			<pathelement path="${classes.dir}" />
		</classpath>
		<batchtest todir="${test.report.dir}">
			<fileset dir="${test.source.dir}">
				<include name="${test.pattern}" />
			</fileset>
		</batchtest>
	</junit>
  </target>
	
	<target name="clean" description="clean up" >
	    <!-- Delete the classes directories -->
	    <delete dir="${test.classes.dir}"/>
	    <delete dir="${classes.dir}"/>
		<delete dir="${test.report.dir}" />
	</target>
	
</project>